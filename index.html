<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>√Üsthetic ‚Äî Random Color & Font Generator</title>
  <meta name="description" content="Generate cohesive color palettes and font pairings for your next project." />
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- UI Shell fonts: DM Sans + Instrument Serif (distinctive, not generic) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet" />

  <style>
    /* ====================================================
       DESIGN TOKENS & THEME
       ==================================================== */
    :root {
      --ui-bg:           #f4f3ef;
      --ui-surface:      #ffffff;
      --ui-surface-2:    #f0efe9;
      --ui-border:       #e2e0d8;
      --ui-text:         #1a1917;
      --ui-text-muted:   #6b6860;
      --ui-accent:       #2a2825;
      --ui-accent-fg:    #f4f3ef;
      --ui-focus:        #2563eb;
      --ui-danger:       #dc2626;
      --ui-success:      #16a34a;
      --ui-warning:      #d97706;
      --ui-shadow:       0 1px 3px rgba(0,0,0,.06), 0 4px 16px rgba(0,0,0,.06);
      --ui-shadow-lg:    0 8px 32px rgba(0,0,0,.1);
      --radius:          12px;
      --radius-sm:       8px;
      --radius-xs:       4px;
      --transition:      150ms cubic-bezier(.4,0,.2,1);
      --font-ui-head:    'Instrument Serif', Georgia, serif;
      --font-ui-body:    'DM Sans', system-ui, sans-serif;
    }

    [data-theme="dark"] {
      --ui-bg:           #171614;
      --ui-surface:      #1e1d1b;
      --ui-surface-2:    #252320;
      --ui-border:       #2e2c28;
      --ui-text:         #f0ede6;
      --ui-text-muted:   #8b8880;
      --ui-accent:       #e8e4da;
      --ui-accent-fg:    #1e1d1b;
      --ui-shadow:       0 1px 3px rgba(0,0,0,.3), 0 4px 16px rgba(0,0,0,.3);
      --ui-shadow-lg:    0 8px 32px rgba(0,0,0,.4);
    }

    /* ====================================================
       RESET & BASE
       ==================================================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html {
      font-size: 16px;
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: var(--font-ui-body);
      background: var(--ui-bg);
      color: var(--ui-text);
      min-height: 100vh;
      transition: background var(--transition), color var(--transition);
      line-height: 1.6;
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: .01ms !important;
        transition-duration: .01ms !important;
      }
    }

    /* ====================================================
       LAYOUT
       ==================================================== */
    .site-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--ui-bg);
      border-bottom: 1px solid var(--ui-border);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition: background var(--transition);
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 clamp(16px, 4vw, 48px);
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .site-title {
      font-family: var(--font-ui-head);
      font-size: 1.5rem;
      font-weight: 400;
      font-style: italic;
      letter-spacing: -.01em;
      color: var(--ui-text);
      text-decoration: none;
    }

    .site-title span {
      font-style: normal;
      opacity: .45;
      font-size: .85em;
      font-family: var(--font-ui-body);
      letter-spacing: .05em;
      font-weight: 300;
      text-transform: uppercase;
    }

    #main {
      /* No overflow clipping ‚Äî let content determine height */
    }

    /* Two-column layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Desktop: side-by-side columns, each as tall as its own
       content. Page scrolls naturally ‚Äî nothing is ever clipped.
       Mobile: single column, stacked.
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .layout-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: start; /* each column only as tall as its content */
      max-width: 1200px;
      margin: 0 auto;
    }

    .col {
      padding: 28px clamp(14px, 2.5vw, 36px) 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .col-left {
      border-right: 1px solid var(--ui-border);
      /* Sticky so the left column stays in view while scrolling past long right content */
      position: sticky;
      top: 0;
      /* Allow left column to scroll internally if it's taller than the viewport */
      max-height: 100vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--ui-border) transparent;
    }

    .col-left::-webkit-scrollbar { width: 5px; }
    .col-left::-webkit-scrollbar-track { background: transparent; }
    .col-left::-webkit-scrollbar-thumb { background: var(--ui-border); border-radius: 3px; }

    @media (max-width: 768px) {
      .layout-columns {
        grid-template-columns: 1fr;
      }
      .col {
        padding: 20px clamp(14px, 4vw, 24px);
        gap: 16px;
      }
      .col-left {
        position: static;
        max-height: none;
        overflow-y: visible;
        border-right: none;
        border-bottom: 1px solid var(--ui-border);
        padding-bottom: 24px;
      }
    }

    .site-footer {
      border-top: 1px solid var(--ui-border);
      padding: 16px clamp(16px, 4vw, 48px);
      text-align: center;
      font-size: .8125rem;
      color: var(--ui-text-muted);
    }

    /* ====================================================
       CARDS
       ==================================================== */
    .card {
      background: var(--ui-surface);
      border: 1px solid var(--ui-border);
      border-radius: var(--radius);
      box-shadow: var(--ui-shadow);
      transition: background var(--transition), border-color var(--transition);
      overflow: hidden;
    }

    .card-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--ui-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .card-title {
      font-family: var(--font-ui-head);
      font-size: 1.125rem;
      font-weight: 400;
      font-style: italic;
      letter-spacing: -.01em;
    }

    .card-body {
      padding: 24px;
    }

    /* ====================================================
       BUTTONS
       ==================================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      padding: 9px 18px;
      border-radius: var(--radius-sm);
      font-family: var(--font-ui-body);
      font-size: .875rem;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all var(--transition);
      text-decoration: none;
      white-space: nowrap;
      line-height: 1.2;
    }

    .btn:focus-visible {
      outline: 2px solid var(--ui-focus);
      outline-offset: 2px;
    }

    .btn-primary {
      background: var(--ui-accent);
      color: var(--ui-accent-fg);
      border-color: var(--ui-accent);
    }

    .btn-primary:hover {
      opacity: .85;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: transparent;
      color: var(--ui-text);
      border-color: var(--ui-border);
    }

    .btn-secondary:hover {
      background: var(--ui-surface-2);
    }

    .btn-ghost {
      background: transparent;
      color: var(--ui-text-muted);
      border-color: transparent;
      padding: 6px 10px;
    }

    .btn-ghost:hover {
      color: var(--ui-text);
      background: var(--ui-surface-2);
    }

    .btn-danger {
      background: transparent;
      color: var(--ui-danger);
      border-color: transparent;
      padding: 6px 10px;
    }

    .btn-danger:hover {
      background: #fef2f2;
    }

    [data-theme="dark"] .btn-danger:hover {
      background: rgba(220,38,38,.15);
    }

    .btn-sm {
      padding: 5px 12px;
      font-size: .8125rem;
    }

    .controls-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }

    /* ====================================================
       THEME TOGGLE SWITCH
       ==================================================== */
    .theme-switch-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .theme-switch-label {
      font-size: .9rem;
      line-height: 1;
      user-select: none;
    }

    /* The hidden checkbox drives the toggle state */
    .theme-switch-wrap input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    /* The visible pill track */
    .theme-switch-track {
      position: relative;
      width: 40px;
      height: 22px;
      border-radius: 11px;
      background: var(--ui-border);
      cursor: pointer;
      transition: background var(--transition);
      flex-shrink: 0;
      border: 1.5px solid var(--ui-text-muted);
    }

    /* The sliding thumb */
    .theme-switch-track::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--ui-text-muted);
      transition: transform var(--transition), background var(--transition);
    }

    /* Checked = dark mode: slide thumb right, fill track */
    .theme-switch-wrap input:checked + .theme-switch-track {
      background: var(--ui-accent);
      border-color: var(--ui-accent);
    }

    .theme-switch-wrap input:checked + .theme-switch-track::after {
      transform: translateX(18px);
      background: var(--ui-accent-fg);
    }

    .theme-switch-wrap input:focus-visible + .theme-switch-track {
      outline: 2px solid var(--ui-focus);
      outline-offset: 2px;
    }

    .theme-switch-track:hover {
      border-color: var(--ui-text);
    }

    /* ====================================================
       PALETTE SWATCHES
       ==================================================== */
    #palette-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 120px), 1fr));
      gap: 12px;
    }

    .swatch {
      border-radius: var(--radius-sm);
      overflow: hidden;
      box-shadow: var(--ui-shadow);
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
      border: 1px solid rgba(0,0,0,.08);
      /* Animation */
      animation: swatchIn 220ms cubic-bezier(.4,0,.2,1) both;
    }

    .swatch:nth-child(1) { animation-delay: 0ms; }
    .swatch:nth-child(2) { animation-delay: 30ms; }
    .swatch:nth-child(3) { animation-delay: 60ms; }
    .swatch:nth-child(4) { animation-delay: 90ms; }
    .swatch:nth-child(5) { animation-delay: 120ms; }
    .swatch:nth-child(6) { animation-delay: 150ms; }

    @keyframes swatchIn {
      from { opacity: 0; transform: translateY(10px) scale(.97); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .swatch:hover { transform: translateY(-3px); box-shadow: var(--ui-shadow-lg); }

    .swatch:focus-visible {
      outline: 2px solid var(--ui-focus);
      outline-offset: 2px;
      transform: translateY(-2px);
    }

    .swatch-color {
      height: 100px;
      width: 100%;
    }

    .swatch-info {
      background: var(--ui-surface);
      padding: 10px 12px;
      transition: background var(--transition);
    }

    .swatch-hex {
      font-family: 'DM Mono', monospace;
      font-size: .8125rem;
      font-weight: 500;
      color: var(--ui-text);
      letter-spacing: .03em;
      display: block;
      margin-bottom: 6px;
    }

    .contrast-badges {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .badge {
      font-size: .65rem;
      font-weight: 600;
      padding: 2px 5px;
      border-radius: 3px;
      letter-spacing: .04em;
      text-transform: uppercase;
    }

    .badge-pass {
      background: #dcfce7;
      color: #15803d;
    }

    .badge-fail {
      background: #fee2e2;
      color: #b91c1c;
    }

    [data-theme="dark"] .badge-pass { background: rgba(21,128,61,.25); color: #86efac; }
    [data-theme="dark"] .badge-fail { background: rgba(185,28,28,.25); color: #fca5a5; }

    .copy-hint {
      font-size: .7rem;
      color: var(--ui-text-muted);
      margin-top: 4px;
      display: block;
    }

    /* ====================================================
       FONT PREVIEW
       ==================================================== */
    #preview-area {
      background: var(--ui-surface-2);
      border-radius: var(--radius-sm);
      padding: clamp(20px, 4vw, 40px);
      transition: background var(--transition);
      animation: fadeIn 250ms ease both;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .preview-heading {
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      font-weight: 700;
      line-height: 1.15;
      margin-bottom: 8px;
      color: var(--ui-text);
      /* font-family injected by JS */
    }

    .preview-subhead {
      font-size: clamp(.9rem, 2vw, 1.1rem);
      font-weight: 400;
      color: var(--ui-text-muted);
      margin-bottom: 16px;
      font-style: italic;
      /* font-family injected by JS */
    }

    .preview-body {
      font-size: .9375rem;
      line-height: 1.7;
      color: var(--ui-text);
      margin-bottom: 20px;
      max-width: 520px;
      /* font-family injected by JS */
    }

    .preview-button {
      display: inline-block;
      padding: 10px 22px;
      background: var(--ui-accent);
      color: var(--ui-accent-fg);
      border-radius: var(--radius-sm);
      font-size: .875rem;
      font-weight: 600;
      cursor: default;
      /* font-family injected by JS */
    }

    .font-meta {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--ui-border);
    }

    .font-chip {
      background: var(--ui-surface);
      border: 1px solid var(--ui-border);
      border-radius: 20px;
      padding: 4px 14px;
      font-size: .8125rem;
      color: var(--ui-text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .font-chip strong {
      color: var(--ui-text);
      font-weight: 600;
    }

    /* ====================================================
       EXPORT SECTION
       ==================================================== */
    .export-pre {
      background: var(--ui-surface-2);
      border: 1px solid var(--ui-border);
      border-radius: var(--radius-sm);
      padding: 16px 18px;
      font-family: 'Courier New', monospace;
      font-size: .8rem;
      line-height: 1.7;
      color: var(--ui-text);
      white-space: pre;
      overflow-x: auto;
      transition: background var(--transition);
      max-height: 240px;
      overflow-y: auto;
    }

    /* ====================================================
       FAVORITES
       ==================================================== */
    #favorites-list {
      display: grid;
      gap: 10px;
    }

    .fav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      background: var(--ui-surface-2);
      border: 1px solid var(--ui-border);
      border-radius: var(--radius-sm);
      transition: background var(--transition), border-color var(--transition);
      animation: swatchIn 200ms ease both;
    }

    .fav-item:hover { border-color: var(--ui-accent); }

    .fav-swatches {
      display: flex;
      gap: 3px;
      flex-shrink: 0;
    }

    .fav-swatch {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid rgba(0,0,0,.1);
    }

    .fav-info {
      flex: 1;
      min-width: 0;
    }

    .fav-name {
      font-size: .875rem;
      font-weight: 500;
      color: var(--ui-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .fav-meta {
      font-size: .75rem;
      color: var(--ui-text-muted);
    }

    .fav-actions {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }

    .empty-state {
      text-align: center;
      padding: 32px 16px;
      color: var(--ui-text-muted);
      font-size: .875rem;
    }

    .empty-state-icon {
      font-size: 2rem;
      display: block;
      margin-bottom: 8px;
      opacity: .4;
    }

    /* ====================================================
       TOAST NOTIFICATION
       ==================================================== */
    #toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9999;
      background: var(--ui-accent);
      color: var(--ui-accent-fg);
      padding: 10px 18px;
      border-radius: var(--radius-sm);
      font-size: .875rem;
      font-weight: 500;
      pointer-events: none;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 200ms ease, transform 200ms ease;
      max-width: calc(100vw - 48px);
      box-shadow: var(--ui-shadow-lg);
    }

    #toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ====================================================
       SECTION LABEL
       ==================================================== */
    .section-label {
      font-size: .7rem;
      font-weight: 600;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--ui-text-muted);
      margin-bottom: 14px;
    }

    /* ====================================================
       TABS
       ==================================================== */
    .tabs {
      display: flex;
      gap: 0;
      border: 1px solid var(--ui-border);
      border-radius: var(--radius-sm);
      overflow: hidden;
      width: fit-content;
    }

    .tab-btn {
      padding: 6px 16px;
      font-size: .8125rem;
      font-weight: 500;
      font-family: var(--font-ui-body);
      background: transparent;
      color: var(--ui-text-muted);
      border: none;
      cursor: pointer;
      transition: all var(--transition);
    }

    .tab-btn:not(:last-child) { border-right: 1px solid var(--ui-border); }

    .tab-btn.active, .tab-btn:hover {
      background: var(--ui-surface-2);
      color: var(--ui-text);
    }

    .tab-btn.active { font-weight: 600; color: var(--ui-text); }

    .tab-btn:focus-visible { outline: 2px solid var(--ui-focus); outline-offset: -2px; }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ====================================================
       KEYBOARD SHORTCUTS BAR
       ==================================================== */
    .shortcuts-bar {
      background: var(--ui-surface-2);
      border-bottom: 1px solid var(--ui-border);
      padding: 0 clamp(16px, 4vw, 48px);
      transition: background var(--transition);
    }

    .shortcuts-inner {
      max-width: 1200px;
      margin: 0 auto;
      height: 36px;
      display: flex;
      align-items: center;
      gap: 4px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .shortcuts-inner::-webkit-scrollbar { display: none; }

    .shortcut-label {
      font-size: .72rem;
      color: var(--ui-text-muted);
      letter-spacing: .02em;
      white-space: nowrap;
      margin-right: 4px;
      font-weight: 500;
    }

    .shortcut-item {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: .72rem;
      color: var(--ui-text-muted);
      white-space: nowrap;
      padding: 0 8px;
      border-right: 1px solid var(--ui-border);
    }

    .shortcut-item:last-child { border-right: none; }

    .shortcut-item kbd {
      display: inline-block;
      background: var(--ui-surface);
      border: 1px solid var(--ui-border);
      border-bottom-width: 2px;
      border-radius: 4px;
      padding: 1px 6px;
      font-family: var(--font-ui-body);
      font-size: .68rem;
      font-weight: 600;
      color: var(--ui-text);
      box-shadow: 0 1px 0 rgba(0,0,0,.08);
      line-height: 1.5;
    }

    @media (max-width: 640px) {
      .shortcuts-bar { display: none; }
    }

    /* ====================================================
       COLOR INFLUENCE CONTROLS
       ==================================================== */
    .color-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    @media (max-width: 560px) {
      .color-controls { grid-template-columns: 1fr; }
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .control-group label {
      font-size: .75rem;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--ui-text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .control-group label span {
      font-weight: 400;
      font-family: 'Courier New', monospace;
      letter-spacing: 0;
      text-transform: none;
      color: var(--ui-text);
      font-size: .8rem;
    }

    /* Color picker with custom wrapper */
    .color-picker-wrap {
      position: relative;
      width: 100%;
      height: 38px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--ui-border);
      overflow: hidden;
      cursor: pointer;
      background: var(--ui-surface-2);
      display: flex;
      align-items: center;
      transition: border-color var(--transition);
    }

    .color-picker-wrap:hover, .color-picker-wrap:focus-within {
      border-color: var(--ui-accent);
    }

    .color-picker-wrap input[type="color"] {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      border: none;
      padding: 0;
    }

    .color-picker-preview {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      margin-left: 5px;
      flex-shrink: 0;
      border: 1px solid rgba(0,0,0,.12);
      pointer-events: none;
    }

    .color-picker-hex {
      font-family: 'Courier New', monospace;
      font-size: .8rem;
      color: var(--ui-text);
      margin-left: 10px;
      pointer-events: none;
    }

    /* Range (slider) input */
    .range-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="range"] {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 2px;
      background: linear-gradient(to right, var(--range-fill, var(--ui-accent)) 0%, var(--range-fill, var(--ui-accent)) var(--range-pct, 50%), var(--ui-border) var(--range-pct, 50%), var(--ui-border) 100%);
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--ui-accent);
      border: 2px solid var(--ui-surface);
      box-shadow: 0 0 0 1px var(--ui-border), var(--ui-shadow);
      cursor: pointer;
      transition: transform var(--transition);
    }

    input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }
    input[type="range"]:focus-visible { outline: 2px solid var(--ui-focus); outline-offset: 4px; border-radius: 2px; }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--ui-accent);
      border: 2px solid var(--ui-surface);
      box-shadow: 0 0 0 1px var(--ui-border);
      cursor: pointer;
    }

    .range-hint { font-size: .7rem; color: var(--ui-text-muted); white-space: nowrap; }

    /* Custom checkbox */
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: .75rem;
      color: var(--ui-text-muted);
      cursor: pointer;
      user-select: none;
      margin-top: 6px;
      white-space: nowrap;   /* never wraps onto a second line */
      width: fit-content;    /* left-aligned, doesn't stretch */
    }

    .checkbox-label:hover { color: var(--ui-text); }

    .checkbox-label input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .checkbox-box {
      width: 15px;
      height: 15px;
      flex-shrink: 0;
      border-radius: 4px;
      /* Stronger border so the box is always visible against any surface */
      border: 1.5px solid var(--ui-text-muted);
      background: var(--ui-surface);
      transition: all var(--transition);
      display: grid;
      place-items: center;
    }

    .checkbox-label:hover .checkbox-box {
      border-color: var(--ui-text);
    }

    .checkbox-box::after {
      content: '';
      width: 8px;
      height: 5px;
      border-left: 2px solid var(--ui-accent-fg);
      border-bottom: 2px solid var(--ui-accent-fg);
      transform: rotate(-45deg) translateY(-1px);
      opacity: 0;
      transition: opacity var(--transition);
    }

    .checkbox-label input:checked ~ .checkbox-box {
      background: var(--ui-accent);
      border-color: var(--ui-accent);
    }

    .checkbox-label input:checked ~ .checkbox-box::after { opacity: 1; }

    .checkbox-label input:focus-visible ~ .checkbox-box {
      outline: 2px solid var(--ui-focus);
      outline-offset: 2px;
    }

    /* Dim the color picker when lock-to-swatch is active */
    .color-picker-wrap.is-locked {
      opacity: .45;
      pointer-events: none;
    }

    /* ====================================================
       PALETTE IN-CONTEXT PREVIEW
       ==================================================== */
    .palette-preview-inner {
      border-radius: var(--radius-sm);
      overflow: hidden;
      box-shadow: var(--ui-shadow);
      border: 1px solid rgba(0,0,0,.08);
      animation: fadeIn 300ms ease both;
    }

    .pp-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      gap: 10px;
    }

    .pp-nav-logo { font-weight: 700; font-size: .875rem; letter-spacing: -.01em; }

    .pp-nav-links { display: flex; gap: 14px; font-size: .75rem; opacity: .75; }

    .pp-nav-cta {
      font-size: .7rem;
      font-weight: 600;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: default;
      white-space: nowrap;
    }

    .pp-hero { padding: 24px 20px; }

    .pp-hero-tag {
      display: inline-block;
      font-size: .65rem;
      font-weight: 700;
      letter-spacing: .1em;
      text-transform: uppercase;
      padding: 3px 9px;
      border-radius: 20px;
      margin-bottom: 12px;
    }

    .pp-hero-h1 { font-size: 1.25rem; font-weight: 700; line-height: 1.2; margin-bottom: 8px; }
    .pp-hero-sub { font-size: .8rem; line-height: 1.6; opacity: .75; margin-bottom: 16px; }

    .pp-hero-btns { display: flex; gap: 8px; flex-wrap: wrap; }

    .pp-btn-primary, .pp-btn-secondary {
      font-size: .75rem;
      font-weight: 600;
      padding: 7px 16px;
      border-radius: 5px;
      cursor: default;
      border: none;
    }

    .pp-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; }

    .pp-card { padding: 14px 16px; }

    .pp-card-icon {
      width: 28px; height: 28px; border-radius: 6px;
      margin-bottom: 8px; display: flex; align-items: center;
      justify-content: center; font-size: .875rem;
    }

    .pp-card-title { font-size: .8rem; font-weight: 700; margin-bottom: 3px; }
    .pp-card-text  { font-size: .72rem; line-height: 1.45; opacity: .7; }

    .pp-footer {
      padding: 10px 16px;
      font-size: .7rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ====================================================
       RESPONSIVE
       ==================================================== */
    @media (max-width: 480px) {
      .controls-bar { flex-direction: column; align-items: stretch; }
      .controls-bar .btn { justify-content: center; }
      #palette-container { grid-template-columns: repeat(3, 1fr); }
      .swatch-color { height: 70px; }
      .pp-nav-links { display: none; }
      .pp-cards { grid-template-columns: 1fr; }
    }

    @media (max-width: 320px) {
      #palette-container { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <a href="#" class="site-title" aria-label="√Üsthetic home">
        √Üsthetic <span>Generator</span>
      </a>
      <label class="theme-switch-wrap" title="Toggle dark/light mode">
        <span class="theme-switch-label" aria-hidden="true">‚òÄÔ∏è</span>
        <input type="checkbox" id="theme-toggle" role="switch" aria-label="Toggle dark mode" aria-checked="false" />
        <span class="theme-switch-track"></span>
        <span class="theme-switch-label" aria-hidden="true">üåô</span>
      </label>
    </div>
  </header>

  <!-- KEYBOARD SHORTCUTS BAR (hidden on mobile) -->
  <nav class="shortcuts-bar" aria-label="Keyboard shortcuts">
    <div class="shortcuts-inner">
      <span class="shortcut-label">Shortcuts:</span>
      <span class="shortcut-item"><kbd>Space</kbd> Shuffle</span>
      <span class="shortcut-item"><kbd>S</kbd> Save</span>
      <span class="shortcut-item"><kbd>C</kbd> Copy CSS</span>
      <span class="shortcut-item"><kbd>‚Üë</kbd><kbd>‚Üì</kbd> Adjust saturation</span>
      <span class="shortcut-item">Click swatch to copy HEX</span>
    </div>
  </nav>

  <main id="main" role="main">
    <div class="layout-columns">

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           LEFT COLUMN: Controls ¬∑ Palette ¬∑ Favorites
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="col col-left">

        <!-- CONTROLS -->
        <section aria-label="Controls" class="card">
          <div class="card-body">
            <div class="controls-bar" role="toolbar" aria-label="Generator controls">
              <button class="btn btn-primary" id="btn-shuffle" aria-label="Shuffle palette and fonts (Space)">
                ‚áÑ Shuffle
              </button>
              <button class="btn btn-secondary" id="btn-save" aria-label="Save current combination (S)">
                ‚ô° Save
              </button>
              <button class="btn btn-secondary" id="btn-copy-css" aria-label="Copy CSS variables (C)">
                {} Copy CSS
              </button>
              <button class="btn btn-secondary" id="btn-export-json" aria-label="Export as JSON">
                ‚Üì JSON
              </button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:12px; padding-top:12px; border-top:1px solid var(--ui-border);">
              <span style="font-size:.8125rem; color:var(--ui-text-muted);">Presets:</span>
              <button class="btn btn-ghost btn-sm" data-preset="minimal">Minimal</button>
              <button class="btn btn-ghost btn-sm" data-preset="playful">Playful</button>
              <button class="btn btn-ghost btn-sm" data-preset="bold">Bold</button>
            </div>
          </div>
        </section>

        <!-- PALETTE CARD -->
        <section class="card" aria-label="Color palette">
          <div class="card-header">
            <h2 class="card-title">Palette</h2>
            <span id="palette-name" style="font-size:.8125rem;color:var(--ui-text-muted);"></span>
          </div>
          <div class="card-body">

            <!-- COLOR INFLUENCE CONTROLS -->
            <div class="color-controls" aria-label="Color influence controls">
              <div class="control-group">
                <label for="base-color-picker">
                  Base Hue
                  <span id="base-color-hex">#888888</span>
                </label>
                <div class="color-picker-wrap" title="Pick a base color to influence the palette">
                  <input type="color" id="base-color-picker" aria-label="Base hue color picker" value="#888888" />
                  <div class="color-picker-preview" id="picker-preview"></div>
                  <span class="color-picker-hex" id="picker-hex-label">#888888</span>
                </div>
                <!-- Lock-to-swatch checkbox -->
                <label class="checkbox-label" for="lock-to-swatch">
                  <input type="checkbox" id="lock-to-swatch" />
                  <span class="checkbox-box" aria-hidden="true"></span>
                  Lock to first swatch
                </label>
              </div>

              <div class="control-group">
                <label for="saturation-slider">
                  Saturation
                  <span id="sat-value-label">50%</span>
                </label>
                <div class="range-wrap">
                  <span class="range-hint">Muted</span>
                  <input type="range" id="saturation-slider" min="5" max="95" value="50"
                         aria-label="Palette saturation (5 to 95 percent)"
                         aria-valuemin="5" aria-valuemax="95" aria-valuenow="50" />
                  <span class="range-hint">Vivid</span>
                </div>
                <span style="font-size:.7rem;color:var(--ui-text-muted);">Use ‚Üë‚Üì arrow keys when focused</span>
              </div>
            </div>

            <!-- SWATCHES -->
            <div id="palette-container" aria-live="polite" aria-label="Color swatches" role="list">
              <!-- Swatches injected by JS -->
            </div>
            <p style="font-size:.75rem;color:var(--ui-text-muted);margin-top:12px;">
              Click any swatch to copy its HEX value
            </p>

          </div>
        </section>

        <!-- FAVORITES CARD -->
        <section class="card" aria-label="Saved favorites">
          <div class="card-header">
            <h2 class="card-title">Favorites</h2>
            <span id="fav-count" style="font-size:.8125rem;color:var(--ui-text-muted);"></span>
          </div>
          <div class="card-body">
            <div id="favorites-list" aria-live="polite" aria-label="Saved combinations">
              <!-- Favorites injected by JS -->
            </div>
          </div>
        </section>

      </div><!-- /col-left -->

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           RIGHT COLUMN: Typography ¬∑ Color Preview ¬∑ Export
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="col col-right">

        <!-- FONT CARD -->
        <section class="card" aria-label="Font pairing">
          <div class="card-header">
            <h2 class="card-title">Typography</h2>
          </div>
          <div class="card-body">
            <div id="preview-area" aria-live="polite">
              <p class="preview-heading" id="preview-h1">The quick brown fox</p>
              <p class="preview-subhead" id="preview-sub">Jumps over the lazy dog</p>
              <p class="preview-body" id="preview-para">
                Beautiful typography is invisible ‚Äî it carries the reader forward without
                demanding attention. Great type sets a mood, establishes hierarchy, and builds trust.
              </p>
              <span class="preview-button" id="preview-btn" aria-hidden="true">Get Started ‚Üí</span>
            </div>
            <div class="font-meta" id="font-meta">
              <!-- Font chips injected by JS -->
            </div>
          </div>
        </section>

        <!-- PALETTE IN-CONTEXT PREVIEW -->
        <section class="card" aria-label="Palette in context">
          <div class="card-header">
            <h2 class="card-title">Palette Preview</h2>
            <span style="font-size:.8125rem;color:var(--ui-text-muted);">Colors in use</span>
          </div>
          <div class="card-body" style="padding:16px;">
            <div class="palette-preview-inner" id="pp-root" aria-live="polite">
              <!-- Injected by JS -->
            </div>
          </div>
        </section>

        <!-- EXPORT CARD -->
        <section class="card" aria-label="Export options">
          <div class="card-header">
            <h2 class="card-title">Export</h2>
            <div class="tabs" role="tablist">
              <button class="tab-btn active" role="tab" data-tab="css" aria-selected="true">CSS</button>
              <button class="tab-btn" role="tab" data-tab="json" aria-selected="false">JSON</button>
            </div>
          </div>
          <div class="card-body">
            <div id="tab-css" class="tab-panel active" role="tabpanel">
              <p class="section-label">CSS Custom Properties</p>
              <pre class="export-pre" id="css-output" aria-label="CSS variables output"></pre>
              <div style="margin-top:12px;">
                <button class="btn btn-secondary btn-sm" id="btn-copy-css2" aria-label="Copy CSS to clipboard">
                  Copy to clipboard
                </button>
              </div>
            </div>
            <div id="tab-json" class="tab-panel" role="tabpanel">
              <p class="section-label">JSON Object</p>
              <pre class="export-pre" id="json-output" aria-label="JSON output"></pre>
              <div style="margin-top:12px; display:flex; gap:10px;">
                <button class="btn btn-secondary btn-sm" id="btn-copy-json" aria-label="Copy JSON to clipboard">
                  Copy to clipboard
                </button>
                <button class="btn btn-secondary btn-sm" id="btn-dl-json" aria-label="Download JSON file">
                  Download .json
                </button>
              </div>
            </div>
          </div>
        </section>

      </div><!-- /col-right -->

    </div><!-- /layout-columns -->
  </main>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <p>√Üsthetic Generator &nbsp;¬∑&nbsp; MIT licensed &nbsp;¬∑&nbsp; Keyboard shortcuts shown above</p>
  </footer>

  <!-- TOAST -->
  <div id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
    /* ====================================================
       CURATED FONT PAIRS
       (heading font ‚Üí body font, google fonts safe)
       ==================================================== */
    const FONT_PAIRS = [
      // --- EDITORIAL / LITERARY ---
      { heading: 'Playfair Display',   body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Playfair Display',   body: 'Lato',              headingWeight: '700', bodyWeight: '300' },
      { heading: 'Cormorant Garamond', body: 'Proza Libre',       headingWeight: '700', bodyWeight: '400' },
      { heading: 'Cormorant Garamond', body: 'Nunito Sans',       headingWeight: '600', bodyWeight: '300' },
      { heading: 'Libre Baskerville',  body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Libre Baskerville',  body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'EB Garamond',        body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'EB Garamond',        body: 'Karla',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Lora',               body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Lora',               body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Merriweather',       body: 'Open Sans',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Merriweather',       body: 'Lato',              headingWeight: '900', bodyWeight: '300' },
      { heading: 'Bitter',             body: 'Quicksand',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Bitter',             body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Rokkitt',            body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      // --- ELEGANT / LUXURY ---
      { heading: 'Bodoni Moda',        body: 'Work Sans',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Bodoni Moda',        body: 'Raleway',           headingWeight: '700', bodyWeight: '300' },
      { heading: 'DM Serif Display',   body: 'Jost',              headingWeight: '400', bodyWeight: '400' },
      { heading: 'DM Serif Display',   body: 'DM Sans',           headingWeight: '400', bodyWeight: '400' },
      { heading: 'Yeseva One',         body: 'Crimson Pro',       headingWeight: '400', bodyWeight: '400' },
      { heading: 'Yeseva One',         body: 'Libre Franklin',    headingWeight: '400', bodyWeight: '400' },
      { heading: 'Fraunces',           body: 'DM Sans',           headingWeight: '700', bodyWeight: '400' },
      { heading: 'Fraunces',           body: 'Inter',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Abril Fatface',      body: 'Raleway',           headingWeight: '400', bodyWeight: '400' },
      { heading: 'Abril Fatface',      body: 'Karla',             headingWeight: '400', bodyWeight: '400' },
      // --- MODERN SANS-SERIF ---
      { heading: 'Space Grotesk',      body: 'IBM Plex Sans',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Space Grotesk',      body: 'Nunito Sans',       headingWeight: '700', bodyWeight: '400' },
      { heading: 'Syne',               body: 'Outfit',            headingWeight: '800', bodyWeight: '400' },
      { heading: 'Syne',               body: 'DM Sans',           headingWeight: '800', bodyWeight: '400' },
      { heading: 'Josefin Sans',       body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Josefin Sans',       body: 'Raleway',           headingWeight: '700', bodyWeight: '400' },
      { heading: 'Raleway',            body: 'Open Sans',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Raleway',            body: 'Lato',              headingWeight: '800', bodyWeight: '300' },
      { heading: 'Nunito',             body: 'Source Sans 3',     headingWeight: '800', bodyWeight: '400' },
      { heading: 'Outfit',             body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      // --- TECH / DEVELOPER ---
      { heading: 'Unbounded',          body: 'Plus Jakarta Sans', headingWeight: '700', bodyWeight: '400' },
      { heading: 'Exo 2',              body: 'Karla',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Exo 2',              body: 'Nunito Sans',       headingWeight: '700', bodyWeight: '400' },
      { heading: 'Orbitron',           body: 'Rajdhani',          headingWeight: '700', bodyWeight: '400' },
      { heading: 'Orbitron',           body: 'Exo 2',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Rajdhani',           body: 'IBM Plex Sans',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Jost',               body: 'Karla',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Plus Jakarta Sans',  body: 'DM Sans',           headingWeight: '700', bodyWeight: '400' },
      { heading: 'IBM Plex Sans',      body: 'Lato',              headingWeight: '700', bodyWeight: '300' },
      { heading: 'Barlow',             body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      // --- HUMANIST / WARM ---
      { heading: 'Nunito Sans',        body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Quicksand',          body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Poppins',            body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Poppins',            body: 'Open Sans',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Mulish',             body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Karla',              body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Cabin',              body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Hind',               body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Barlow Condensed',   body: 'Barlow',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Asap',               body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      // --- DISPLAY / EXPRESSIVE ---
      { heading: 'Righteous',          body: 'Nunito',            headingWeight: '400', bodyWeight: '400' },
      { heading: 'Righteous',          body: 'Lato',              headingWeight: '400', bodyWeight: '300' },
      { heading: 'Fredoka',            body: 'Quicksand',         headingWeight: '700', bodyWeight: '400' },
      { heading: 'Pacifico',           body: 'Lato',              headingWeight: '400', bodyWeight: '300' },
      { heading: 'Pacifico',           body: 'Nunito',            headingWeight: '400', bodyWeight: '400' },
      { heading: 'Lobster Two',        body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Comfortaa',          body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Comfortaa',          body: 'Mulish',            headingWeight: '700', bodyWeight: '300' },
      { heading: 'Cinzel',             body: 'Lato',              headingWeight: '700', bodyWeight: '300' },
      { heading: 'Cinzel',             body: 'Raleway',           headingWeight: '700', bodyWeight: '300' },
      // --- SLAB SERIF ---
      { heading: 'Zilla Slab',         body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Zilla Slab',         body: 'Open Sans',         headingWeight: '600', bodyWeight: '400' },
      { heading: 'Arvo',               body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Arvo',               body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Rockwell',           body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Crete Round',        body: 'Mulish',            headingWeight: '400', bodyWeight: '400' },
      { heading: 'Slabo 27px',         body: 'Open Sans',         headingWeight: '400', bodyWeight: '400' },
      { heading: 'Alfa Slab One',      body: 'Lato',              headingWeight: '400', bodyWeight: '300' },
      { heading: 'Tinos',              body: 'Arimo',             headingWeight: '700', bodyWeight: '400' },
      { heading: 'Kameron',            body: 'Hind',              headingWeight: '700', bodyWeight: '400' },
      // --- GEOMETRIC / STRUCTURED ---
      { heading: 'Fustat',             body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Teko',               body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Anton',              body: 'Raleway',           headingWeight: '400', bodyWeight: '400' },
      { heading: 'Anton',              body: 'Lato',              headingWeight: '400', bodyWeight: '300' },
      { heading: 'Kanit',              body: 'Nunito',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Kanit',              body: 'Karla',             headingWeight: '600', bodyWeight: '400' },
      { heading: 'Fjalla One',         body: 'Cantarell',         headingWeight: '400', bodyWeight: '400' },
      { heading: 'Oswald',             body: 'Lato',              headingWeight: '700', bodyWeight: '300' },
      { heading: 'Oswald',             body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'PT Sans Narrow',     body: 'PT Sans',           headingWeight: '700', bodyWeight: '400' },
      // --- REFINED / TRANSITIONAL ---
      { heading: 'Spectral',           body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Spectral',           body: 'Nunito Sans',       headingWeight: '700', bodyWeight: '400' },
      { heading: 'Crimson Pro',        body: 'Jost',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Domine',             body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'PT Serif',           body: 'PT Sans',           headingWeight: '700', bodyWeight: '400' },
      { heading: 'Alegreya',           body: 'Lato',              headingWeight: '700', bodyWeight: '400' },
      { heading: 'Alegreya',           body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Neuton',             body: 'Mulish',            headingWeight: '700', bodyWeight: '400' },
      { heading: 'Vollkorn',           body: 'Source Sans 3',     headingWeight: '700', bodyWeight: '400' },
      { heading: 'Libre Caslon Text',  body: 'Nunito Sans',       headingWeight: '700', bodyWeight: '400' },
    ];

    /* ====================================================
       CURATED PALETTES ‚Äî used for random generation seeds
       and for the 3 preset defaults
       ==================================================== */
    const PRESET_PALETTES = {
      minimal: {
        name: 'Minimal',
        colors: ['#f8f7f4', '#e8e4dc', '#9e9b91', '#4a4843', '#1c1b19', '#d4a853'],
        fonts: FONT_PAIRS[0], // Playfair + Source Sans
      },
      playful: {
        name: 'Playful',
        colors: ['#fff0f3', '#ffb3c1', '#fb5072', '#c1121f', '#4cc9f0', '#f9c74f'],
        fonts: FONT_PAIRS[4], // Josefin + Nunito
      },
      bold: {
        name: 'Bold',
        colors: ['#0d0d0d', '#1a1a2e', '#16213e', '#0f3460', '#e94560', '#f5a623'],
        fonts: FONT_PAIRS[6], // Unbounded + Plus Jakarta
      },
    };

    /* Random palette generation ‚Äî uses HSL math to build
       aesthetically-related sets (monochromatic, analogous, split-comp) */
    const PALETTE_STRATEGIES = [
      'monochromatic', 'analogous', 'split-complementary', 'triadic', 'tetradic'
    ];

    /* ====================================================
       WCAG 2.1 CONTRAST UTILITIES
       ==================================================== */

    /** Convert HEX to sRGB [0..1] */
    function hexToRgb(hex) {
      const h = hex.replace('#', '');
      const r = parseInt(h.slice(0,2), 16) / 255;
      const g = parseInt(h.slice(2,4), 16) / 255;
      const b = parseInt(h.slice(4,6), 16) / 255;
      return [r, g, b];
    }

    /** Linearize sRGB channel (WCAG formula) */
    function linearize(c) {
      return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
    }

    /** Relative luminance from HEX */
    function getLuminance(hex) {
      const [r, g, b] = hexToRgb(hex).map(linearize);
      return 0.2126 * r + 0.7152 * g + 0.0722 * b;
    }

    /** Contrast ratio between two HEX colors */
    function contrastRatio(hex1, hex2) {
      const l1 = getLuminance(hex1);
      const l2 = getLuminance(hex2);
      const lighter = Math.max(l1, l2);
      const darker  = Math.min(l1, l2);
      return (lighter + 0.05) / (darker + 0.05);
    }

    /** WCAG AA pass requires ‚â• 4.5:1 for normal text */
    function checkContrast(hex) {
      const vsWhite = contrastRatio(hex, '#ffffff');
      const vsBlack = contrastRatio(hex, '#000000');
      return {
        vsWhite: { ratio: vsWhite, pass: vsWhite >= 4.5 },
        vsBlack: { ratio: vsBlack, pass: vsBlack >= 4.5 },
      };
    }

    /* ====================================================
       COLOR GENERATION
       ==================================================== */

    /** Convert HSL to HEX */
    function hslToHex(h, s, l) {
      h = ((h % 360) + 360) % 360;
      s = Math.max(0, Math.min(100, s));
      l = Math.max(0, Math.min(100, l));
      const sl = s / 100, ll = l / 100;
      const a = sl * Math.min(ll, 1 - ll);
      const f = n => {
        const k = (n + h / 30) % 12;
        const color = ll - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
        return Math.round(255 * color).toString(16).padStart(2, '0');
      };
      return `#${f(0)}${f(8)}${f(4)}`;
    }

    /** Generate a random palette of 4‚Äì6 colors using a strategy.
     *  baseHue: optional fixed hue (0-360); null = random
     *  satPct: saturation percentage (5-95); default 50
     */
    function getRandomPalette(baseHue = null, satPct = 50) {
      const strategy = PALETTE_STRATEGIES[Math.floor(Math.random() * PALETTE_STRATEGIES.length)];
      const h = baseHue !== null ? baseHue : Math.random() * 360;
      // Map satPct (5-95) to a workable baseSat range (8-80)
      const baseSat = 8 + (satPct / 100) * 72;
      const colors = [];

      if (strategy === 'monochromatic') {
        const lightnesses = [92, 78, 58, 38, 22, 10];
        const count = 4 + Math.floor(Math.random() * 3);
        for (let i = 0; i < count; i++) {
          colors.push(hslToHex(h, baseSat, lightnesses[i]));
        }
      } else if (strategy === 'analogous') {
        const spread = 20 + Math.random() * 20;
        const hues = [h - spread, h, h + spread, h + spread * 2];
        hues.forEach((hh, i) => colors.push(hslToHex(hh, baseSat, [75, 55, 40, 25][i])));
        // add a neutral
        colors.push(hslToHex(h, Math.min(baseSat * 0.15, 8), 92));
        colors.push(hslToHex(h, Math.min(baseSat * 0.15, 8), 12));
      } else if (strategy === 'split-complementary') {
        const comp1 = h + 150;
        const comp2 = h + 210;
        colors.push(hslToHex(h, baseSat, 65));
        colors.push(hslToHex(h, baseSat, 40));
        colors.push(hslToHex(comp1, Math.max(baseSat - 10, 5), 60));
        colors.push(hslToHex(comp2, Math.max(baseSat - 10, 5), 55));
        colors.push(hslToHex(h, Math.min(baseSat * 0.1, 6), 96));
        colors.push(hslToHex(h, Math.min(baseSat * 0.1, 6), 10));
      } else if (strategy === 'triadic') {
        [h, h + 120, h + 240].forEach((hh, i) => {
          colors.push(hslToHex(hh, baseSat, [60, 45, 55][i]));
        });
        colors.push(hslToHex(h, Math.min(baseSat * 0.1, 5), 95));
        colors.push(hslToHex(h, Math.min(baseSat * 0.1, 5), 15));
      } else { // tetradic
        [h, h + 90, h + 180, h + 270].forEach((hh, i) => {
          colors.push(hslToHex(hh, Math.max(baseSat - i * 5, 5), [65, 50, 60, 45][i]));
        });
        colors.push(hslToHex(h, Math.min(baseSat * 0.1, 5), 95));
      }

      // Snapshot the HSL values so remapSaturation can later adjust only saturation.
      currentPaletteHsl = colors.map(hex => hexToHsl(hex));
      // Record the saturation level used at generation time (the baseline for remap).
      colorInfluence._genSaturation = satPct;
      return { name: capitalize(strategy), colors };
    }

    function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

    /* ====================================================
       FONT UTILITIES
       ==================================================== */
    let loadedFontLinks = {};

    /** Pick a random font pair (not the current one) */
    function pickFontPair(exclude) {
      const filtered = FONT_PAIRS.filter(p => !exclude || p.heading !== exclude.heading);
      return filtered[Math.floor(Math.random() * filtered.length)];
    }

    /** Dynamically inject a Google Fonts <link> for a pair if not already loaded */
    function applyFonts(pair) {
      const key = `${pair.heading}|${pair.body}`;
      if (!loadedFontLinks[key]) {
        const families = [
          `family=${encodeURIComponent(pair.heading)}:wght@${pair.headingWeight}`,
          `family=${encodeURIComponent(pair.body)}:wght@${pair.bodyWeight}`,
        ].join('&');
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = `https://fonts.googleapis.com/css2?${families}&display=swap`;
        document.head.appendChild(link);
        loadedFontLinks[key] = true;
      }

      // Apply to preview elements
      const el = (id) => document.getElementById(id);
      el('preview-h1').style.fontFamily = `'${pair.heading}', serif`;
      el('preview-h1').style.fontWeight = pair.headingWeight;
      el('preview-sub').style.fontFamily = `'${pair.heading}', serif`;
      el('preview-para').style.fontFamily = `'${pair.body}', sans-serif`;
      el('preview-btn').style.fontFamily = `'${pair.body}', sans-serif`;
    }

    /* ====================================================
       RENDER FUNCTIONS
       ==================================================== */

    /** Render palette swatches */
    function renderPalette(palette) {
      const container = document.getElementById('palette-container');
      document.getElementById('palette-name').textContent = palette.name;

      // Sync color picker to reflect current palette
      syncColorPickerToState(palette);

      // Fade out then rebuild
      container.style.opacity = '0';
      container.style.transform = 'translateY(6px)';

      setTimeout(() => {
        container.innerHTML = '';
        palette.colors.forEach((hex, i) => {
          const c = checkContrast(hex);

          const swatch = document.createElement('div');
          swatch.className = 'swatch';
          swatch.setAttribute('role', 'listitem');
          swatch.setAttribute('tabindex', '0');
          swatch.setAttribute('aria-label', `Color ${hex}. Click to copy.`);
          swatch.style.animationDelay = `${i * 30}ms`;

          swatch.innerHTML = `
            <div class="swatch-color" style="background:${hex};" aria-hidden="true"></div>
            <div class="swatch-info">
              <span class="swatch-hex">${hex.toUpperCase()}</span>
              <div class="contrast-badges" aria-label="Contrast ratios">
                <span class="badge ${c.vsWhite.pass ? 'badge-pass' : 'badge-fail'}"
                      title="Contrast vs white: ${c.vsWhite.ratio.toFixed(2)}:1"
                      aria-label="vs white ${c.vsWhite.ratio.toFixed(1)}:1 ${c.vsWhite.pass ? 'AA pass' : 'AA fail'}">
                  W ${c.vsWhite.ratio.toFixed(1)}
                </span>
                <span class="badge ${c.vsBlack.pass ? 'badge-pass' : 'badge-fail'}"
                      title="Contrast vs black: ${c.vsBlack.ratio.toFixed(2)}:1"
                      aria-label="vs black ${c.vsBlack.ratio.toFixed(1)}:1 ${c.vsBlack.pass ? 'AA pass' : 'AA fail'}">
                  B ${c.vsBlack.ratio.toFixed(1)}
                </span>
              </div>
              <span class="copy-hint">click to copy</span>
            </div>
          `;

          // Copy on click or Enter/Space
          const copyAction = () => {
            copyText(hex.toUpperCase());
            toast(`Copied ${hex.toUpperCase()}`);
          };
          swatch.addEventListener('click', copyAction);
          swatch.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); copyAction(); }
          });

          container.appendChild(swatch);
        });

        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
        container.style.transition = 'opacity 200ms ease, transform 200ms ease';
      }, 80);
    }

    /** Render font pair preview */
    function renderPreview(pair) {
      applyFonts(pair);

      const meta = document.getElementById('font-meta');
      meta.innerHTML = `
        <span class="font-chip"><strong>Heading</strong> ${pair.heading}</span>
        <span class="font-chip"><strong>Body</strong> ${pair.body}</span>
      `;

      // Subtle fade-in on preview area
      const area = document.getElementById('preview-area');
      area.style.opacity = '0';
      setTimeout(() => {
        area.style.opacity = '1';
        area.style.transition = 'opacity 250ms ease';
      }, 100);
    }

    /** Render the export panels for the current state */
    function renderExports(state) {
      document.getElementById('css-output').textContent = exportCSSVars(state);
      document.getElementById('json-output').textContent = JSON.stringify(exportJSON(state), null, 2);
    }

    /* ====================================================
       EXPORT BUILDERS
       ==================================================== */

    function exportCSSVars(state) {
      const lines = [':root {'];
      state.palette.colors.forEach((hex, i) => {
        lines.push(`  --color-${i + 1}: ${hex.toUpperCase()};`);
      });
      lines.push(`  --font-heading: '${state.fonts.heading}', serif;`);
      lines.push(`  --font-body: '${state.fonts.body}', sans-serif;`);
      lines.push('}');
      return lines.join('\n');
    }

    function exportJSON(state) {
      return {
        palette: state.palette.colors.map(c => c.toUpperCase()),
        fonts: {
          heading: state.fonts.heading,
          body: state.fonts.body,
        },
        name: state.palette.name,
      };
    }

    /* ====================================================
       FAVORITES (localStorage)
       ==================================================== */
    const LS_KEY_FAV = 'aesthetic.favorites';
    const LS_KEY_SETTINGS = 'aesthetic.settings';

    function loadFavorites() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_FAV)) || []; }
      catch { return []; }
    }

    function saveFavorites(favs) {
      localStorage.setItem(LS_KEY_FAV, JSON.stringify(favs));
    }

    function saveFavorite(state) {
      const favs = loadFavorites();
      const entry = {
        id: Date.now(),
        palette: state.palette,
        fonts: state.fonts,
        savedAt: new Date().toISOString(),
      };
      favs.unshift(entry);
      saveFavorites(favs);
      renderFavorites();
      toast('Saved to favorites!');
    }

    function deleteFavorite(id) {
      const favs = loadFavorites().filter(f => f.id !== id);
      saveFavorites(favs);
      renderFavorites();
    }

    function renderFavorites() {
      const favs = loadFavorites();
      const list = document.getElementById('favorites-list');
      const count = document.getElementById('fav-count');

      count.textContent = favs.length ? `${favs.length} saved` : '';

      if (!favs.length) {
        list.innerHTML = `
          <div class="empty-state">
            <span class="empty-state-icon" aria-hidden="true">‚ô°</span>
            No saved combinations yet. Hit <strong>Save</strong> or press <kbd>S</kbd>.
          </div>`;
        return;
      }

      list.innerHTML = '';
      favs.forEach(fav => {
        const item = document.createElement('div');
        item.className = 'fav-item';

        const swatchDots = fav.palette.colors
          .map(c => `<span class="fav-swatch" style="background:${c};" aria-hidden="true"></span>`)
          .join('');

        const savedDate = new Date(fav.savedAt).toLocaleDateString();

        item.innerHTML = `
          <div class="fav-swatches" aria-hidden="true">${swatchDots}</div>
          <div class="fav-info">
            <div class="fav-name">${fav.palette.name} ‚Äî ${fav.fonts.heading}</div>
            <div class="fav-meta">${fav.fonts.body} ¬∑ ${savedDate}</div>
          </div>
          <div class="fav-actions">
            <button class="btn btn-ghost btn-sm" data-apply="${fav.id}" aria-label="Apply ${fav.palette.name} combination">Apply</button>
            <button class="btn btn-danger btn-sm" data-delete="${fav.id}" aria-label="Delete ${fav.palette.name} combination">‚úï</button>
          </div>
        `;

        // Wire events
        item.querySelector('[data-apply]').addEventListener('click', () => applyState({
          palette: fav.palette,
          fonts: fav.fonts,
        }));
        item.querySelector('[data-delete]').addEventListener('click', () => deleteFavorite(fav.id));

        list.appendChild(item);
      });
    }

    /* ====================================================
       CLIPBOARD
       ==================================================== */
    function copyText(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      try { document.execCommand('copy'); } catch {}
      document.body.removeChild(ta);
    }

    /* ====================================================
       TOAST
       ==================================================== */
    let toastTimer;
    function toast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => el.classList.remove('show'), 2200);
    }

    /* ====================================================
       COLOR INFLUENCE STATE
       ==================================================== */
    let colorInfluence = {
      baseHue: null,       // null = random; 0-360 = locked hue
      saturation: 50,      // 5-95 percent (slider value)
      _genSaturation: 50,  // the saturation used when the palette was generated (baseline for remap)
    };

    // Stores [h, s, l] for each swatch at generation time.
    // Used by remapSaturation to adjust only saturation without touching hues.
    let currentPaletteHsl = [];

    /** Convert HEX color to HSL components */
    function hexToHsl(hex) {
      const [r, g, b] = hexToRgb(hex);
      const max = Math.max(r,g,b), min = Math.min(r,g,b);
      let h, s, l = (max + min) / 2;
      if (max === min) { h = s = 0; }
      else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch(max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
    }

    /** Re-map only the saturation channel of the current palette.
     *  Keeps every swatch's hue and lightness identical; only scales saturation.
     *  satPct: new target (5-95). Returns a new palette object.
     */
    function remapSaturation(satPct) {
      if (!currentPaletteHsl.length || !currentState.palette) return null;
      const baseline = colorInfluence._genSaturation || 50;
      const ratio = satPct / baseline;
      const newColors = currentPaletteHsl.map(([h, origS, l]) => {
        const newS = Math.max(0, Math.min(100, origS * ratio));
        return hslToHex(h, newS, l);
      });
      return { ...currentState.palette, colors: newColors };
    }

    /* ====================================================
       APP STATE
       ==================================================== */
    let currentState = {
      palette: null,
      fonts: null,
    };

    /** Apply a full state object (palette + fonts) and re-render everything */
    function applyState(state) {
      currentState = state;
      // Always keep currentPaletteHsl in sync so saturation remap works correctly
      // even when a preset or favorite is applied (not generated via getRandomPalette).
      currentPaletteHsl = state.palette.colors.map(hex => hexToHsl(hex));
      if (!colorInfluence._genSaturation) colorInfluence._genSaturation = colorInfluence.saturation;
      renderPalette(state.palette);
      renderPreview(state.fonts);
      renderPalettePreview(state.palette);
      renderExports(state);
    }

    /** Shuffle: generate new random palette and font pair, respecting color influence */
    function shuffle() {
      // Reset the generation baseline to the current slider value before generating
      colorInfluence._genSaturation = colorInfluence.saturation;
      const palette = getRandomPalette(colorInfluence.baseHue, colorInfluence.saturation);
      const fonts = pickFontPair(currentState.fonts);
      applyState({ palette, fonts });
    }

    /* ====================================================
       PRACTICAL PALETTE PREVIEW
       Renders a mini UI mockup using the palette colors to
       show how they work together in a real context.
       ==================================================== */
    function renderPalettePreview(palette) {
      const c = palette.colors;
      // Pick 4+ colors, fallback gracefully if palette is smaller
      const bg0  = c[0] || '#f8f8f8';  // nav bg
      const bg1  = c[1] || '#eeeeee';  // hero bg
      const bg2  = c[2] || '#dddddd';  // cards bg
      const bg3  = c[3] || '#cccccc';  // footer bg
      const acc  = c[4] || c[3] || c[2]; // accent / CTA
      const acc2 = c[5] || c[4] || c[0]; // secondary accent

      // Decide text colors per-region based on contrast
      const textFor = (bg) => {
        const vsWhite = contrastRatio(bg, '#ffffff');
        const vsBlack = contrastRatio(bg, '#000000');
        return vsBlack > vsWhite ? '#111111' : '#f8f8f8';
      };

      const t0 = textFor(bg0);
      const t1 = textFor(bg1);
      const t2 = textFor(bg2);
      const t3 = textFor(bg3);
      const ta = textFor(acc);

      const root = document.getElementById('pp-root');
      root.innerHTML = `
        <!-- Nav -->
        <div class="pp-nav" style="background:${bg0};color:${t0};">
          <div class="pp-nav-logo" style="color:${t0};">Brand</div>
          <div class="pp-nav-links" style="color:${t0};">
            <span>About</span><span>Work</span><span>Blog</span>
          </div>
          <div class="pp-nav-cta" style="background:${acc};color:${ta};">Contact</div>
        </div>

        <!-- Hero -->
        <div class="pp-hero" style="background:${bg1};color:${t1};">
          <div class="pp-hero-tag" style="background:${acc};color:${ta};">New Release</div>
          <div class="pp-hero-h1" style="color:${t1};">Design with intention, ship with confidence</div>
          <div class="pp-hero-sub" style="color:${t1};">A modern toolkit for teams who care about craft and want beautiful results fast.</div>
          <div class="pp-hero-btns">
            <div class="pp-btn-primary" style="background:${acc};color:${ta};">Get started free</div>
            <div class="pp-btn-secondary" style="background:transparent;color:${t1};border:1.5px solid ${t1};opacity:.75;">See examples ‚Üí</div>
          </div>
        </div>

        <!-- Feature cards -->
        <div class="pp-cards" style="background:${bg2};">
          <div class="pp-card" style="background:${bg2};color:${t2};">
            <div class="pp-card-icon" style="background:${acc};color:${ta};">‚ú¶</div>
            <div class="pp-card-title" style="color:${t2};">Smart Layout</div>
            <div class="pp-card-text" style="color:${t2};">Responsive grids that adapt to any screen with zero effort.</div>
          </div>
          <div class="pp-card" style="background:${bg2};color:${t2};border-left:1px solid rgba(128,128,128,.15);border-right:1px solid rgba(128,128,128,.15);">
            <div class="pp-card-icon" style="background:${acc2};color:${textFor(acc2)};">‚óà</div>
            <div class="pp-card-title" style="color:${t2};">Tokens & Vars</div>
            <div class="pp-card-text" style="color:${t2};">Export CSS variables and design tokens in one click.</div>
          </div>
          <div class="pp-card" style="background:${bg2};color:${t2};">
            <div class="pp-card-icon" style="background:${acc};color:${ta};">‚óé</div>
            <div class="pp-card-title" style="color:${t2};">Accessibility</div>
            <div class="pp-card-text" style="color:${t2};">WCAG AA contrast checked live as you build.</div>
          </div>
        </div>

        <!-- Footer -->
        <div class="pp-footer" style="background:${bg3};color:${t3};">
          <span>¬© 2025 Brand Inc.</span>
          <span style="opacity:.6;">Privacy ¬∑ Terms ¬∑ Cookies</span>
        </div>
      `;
    }

    /* ====================================================
       COLOR CONTROLS WIRING
       ==================================================== */
    function initColorControls() {
      const picker        = document.getElementById('base-color-picker');
      const pickerWrap    = document.querySelector('.color-picker-wrap');
      const pickerPreview = document.getElementById('picker-preview');
      const pickerHexLabel= document.getElementById('picker-hex-label');
      const baseColorHex  = document.getElementById('base-color-hex');
      const satSlider     = document.getElementById('saturation-slider');
      const satLabel      = document.getElementById('sat-value-label');
      const lockCheckbox  = document.getElementById('lock-to-swatch');

      function updateSliderFill(val) {
        const pct = ((val - 5) / (95 - 5)) * 100;
        satSlider.style.setProperty('--range-pct', `${pct}%`);
      }

      updateSliderFill(satSlider.value);

      // Color picker: extract hue, re-generate palette
      picker.addEventListener('input', () => {
        const hex = picker.value;
        pickerPreview.style.background = hex;
        pickerHexLabel.textContent = hex.toUpperCase();
        baseColorHex.textContent = hex.toUpperCase();
        const [h] = hexToHsl(hex);
        colorInfluence.baseHue = h;
        const palette = getRandomPalette(colorInfluence.baseHue, colorInfluence.saturation);
        applyState({ palette, fonts: currentState.fonts });
      });

      // Saturation slider: re-map saturation on the EXISTING palette (no new hues/strategy).
      satSlider.addEventListener('input', () => {
        const val = parseInt(satSlider.value);
        colorInfluence.saturation = val;
        satLabel.textContent = `${val}%`;
        updateSliderFill(val);
        satSlider.setAttribute('aria-valuenow', val);
        const remapped = remapSaturation(val);
        if (remapped) {
          // Update currentState.palette directly and re-render without regenerating
          currentState = { ...currentState, palette: remapped };
          renderPalette(remapped);
          renderPalettePreview(remapped);
          renderExports(currentState);
        }
      });

      // Lock-to-swatch checkbox:
      // When checked, read the hue from the first swatch and set colorInfluence.baseHue.
      // The current palette is NOT regenerated ‚Äî it stays exactly as-is.
      // The locked hue only takes effect on the next shuffle or saturation change.
      lockCheckbox.addEventListener('change', () => {
        const locked = lockCheckbox.checked;
        pickerWrap.classList.toggle('is-locked', locked);

        if (locked && currentState.palette?.colors?.length) {
          const firstSwatch = currentState.palette.colors[0];
          const [h] = hexToHsl(firstSwatch);
          colorInfluence.baseHue = h;
          applyPickerColor(firstSwatch);
          // No palette regeneration ‚Äî palette stays unchanged
        }
        // Unlocking: colorInfluence.baseHue stays at whatever it was; picker is freed.
      });
    }

    /** Update just the picker UI elements (not influence state) */
    function applyPickerColor(hex) {
      const picker         = document.getElementById('base-color-picker');
      const pickerPreview  = document.getElementById('picker-preview');
      const pickerHexLabel = document.getElementById('picker-hex-label');
      const baseColorHex   = document.getElementById('base-color-hex');
      picker.value = hex;
      pickerPreview.style.background = hex;
      pickerHexLabel.textContent = hex.toUpperCase();
      baseColorHex.textContent = hex.toUpperCase();
    }

    /** Sync the color picker UI to visually reflect the current palette.
     *  IMPORTANT: this function only updates the visual picker display.
     *  It never modifies colorInfluence.baseHue ‚Äî that is only set by
     *  explicit user actions (manual picker input or lock-to-swatch checkbox).
     */
    function syncColorPickerToState(palette) {
      if (!palette.colors.length) return;
      const lockCheckbox = document.getElementById('lock-to-swatch');
      const locked = lockCheckbox?.checked;

      // Show the first swatch when locked, otherwise a representative mid-palette color
      const rep = locked
        ? palette.colors[0]
        : palette.colors[Math.min(2, palette.colors.length - 1)];

      applyPickerColor(rep);
      // colorInfluence.baseHue is intentionally NOT touched here
    }

    /* ====================================================
       TABS
       ==================================================== */
    function initTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tabName = btn.dataset.tab;
          document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.toggle('active', b.dataset.tab === tabName);
            b.setAttribute('aria-selected', b.dataset.tab === tabName);
          });
          document.querySelectorAll('.tab-panel').forEach(p => {
            p.classList.toggle('active', p.id === `tab-${tabName}`);
          });
        });
      });
    }

    /* ====================================================
       DARK MODE
       ==================================================== */
    function getTheme() {
      try { return JSON.parse(localStorage.getItem(LS_KEY_SETTINGS))?.theme || 'light'; }
      catch { return 'light'; }
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      // Sync the switch checkbox state
      const toggle = document.getElementById('theme-toggle');
      if (toggle) {
        toggle.checked = (theme === 'dark');
        toggle.setAttribute('aria-checked', theme === 'dark');
      }
      try {
        localStorage.setItem(LS_KEY_SETTINGS, JSON.stringify({ theme }));
      } catch {}
    }

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      setTheme(current === 'dark' ? 'light' : 'dark');
    }

    /* ====================================================
       KEYBOARD SHORTCUTS
       ==================================================== */
    function initKeyboard() {
      document.addEventListener('keydown', e => {
        // Don't fire when user is typing in an input (except range sliders which we handle)
        if (e.target.matches('input[type="text"], textarea, [contenteditable]')) return;

        // Arrow Up/Down adjust saturation (but let the slider handle its own keys when focused)
        if ((e.key === 'ArrowUp' || e.key === 'ArrowDown') && !e.target.matches('input[type="range"]')) {
          e.preventDefault();
          const slider = document.getElementById('saturation-slider');
          const delta = e.key === 'ArrowUp' ? 5 : -5;
          const newVal = Math.max(5, Math.min(95, parseInt(slider.value) + delta));
          slider.value = newVal;
          slider.dispatchEvent(new Event('input'));
          return;
        }

        // Don't fire other shortcuts when focused on any input
        if (e.target.matches('input, textarea, [contenteditable]')) return;

        switch (e.key) {
          case ' ':
            e.preventDefault();
            shuffle();
            break;
          case 's':
          case 'S':
            if (!e.metaKey && !e.ctrlKey) {
              e.preventDefault();
              saveFavorite(currentState);
            }
            break;
          case 'c':
          case 'C':
            if (!e.metaKey && !e.ctrlKey) {
              e.preventDefault();
              copyText(exportCSSVars(currentState));
              toast('CSS variables copied!');
            }
            break;
        }
      });
    }

    /* ====================================================
       BUTTON WIRING
       ==================================================== */
    function initButtons() {
      document.getElementById('btn-shuffle').addEventListener('click', shuffle);

      document.getElementById('btn-save').addEventListener('click', () => saveFavorite(currentState));

      document.getElementById('btn-copy-css').addEventListener('click', () => {
        copyText(exportCSSVars(currentState));
        toast('CSS variables copied!');
      });

      document.getElementById('btn-copy-css2').addEventListener('click', () => {
        copyText(exportCSSVars(currentState));
        toast('CSS variables copied!');
      });

      document.getElementById('btn-export-json').addEventListener('click', () => {
        downloadJSON(exportJSON(currentState));
      });

      document.getElementById('btn-copy-json').addEventListener('click', () => {
        copyText(JSON.stringify(exportJSON(currentState), null, 2));
        toast('JSON copied!');
      });

      document.getElementById('btn-dl-json').addEventListener('click', () => {
        downloadJSON(exportJSON(currentState));
      });

      document.getElementById('theme-toggle').addEventListener('change', toggleTheme);

      // Preset buttons
      document.querySelectorAll('[data-preset]').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.preset;
          const preset = PRESET_PALETTES[key];
          applyState({ palette: preset, fonts: preset.fonts });
        });
      });
    }

    /** Download the JSON object as a .json file */
    function downloadJSON(obj) {
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `aesthetic-${obj.name?.toLowerCase().replace(/\s+/g,'-') || 'palette'}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      toast('JSON downloaded!');
    }

    /* ====================================================
       INIT
       ==================================================== */
    function init() {
      // Restore theme preference
      setTheme(getTheme());

      // Wire up UI
      initTabs();
      initButtons();
      initKeyboard();
      initColorControls();
      renderFavorites();

      // Start with the "Minimal" preset
      const minimal = PRESET_PALETTES.minimal;
      applyState({ palette: minimal, fonts: minimal.fonts });
    }

    // Defer until DOM is ready (script is at bottom of body so this fires immediately,
    // but using DOMContentLoaded as belt-and-suspenders)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>